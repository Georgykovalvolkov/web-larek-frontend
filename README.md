# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src\scss\styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара

```
interface IProduct {
    _id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```

Данные заказа

```
interface IOrder {
    payment: TPayMethod
    address: string;
    email: string;
    phone: string;
    total: number
    items: string[]
}
```

Интерфейс для модели данных карточек товара

```
interface IProductsData {
    cards: IProduct[];
    preview: string | null;
}
```

Интерфейс для модели данных корзины

```
interface IBasket {
    products: IProduct[];
    product: string | null;
    addProduct(product: IProduct): void;
    deleteProduct(productId: string): void;
    priceCalc(productPrice: number): void;
}
```

Данные метода оплаты

```
type TPayMethod = 'cash' | 'card'
```

Данные юзера

```
type TUserData = Pick<IOrder, 'email' | 'phone' | 'address' | 'payment'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными карточек товара.\
Конструктор класса принимает инстант брокера событий
В полях класса хранятся следующие данные:
- _products: IProduct[] - массив объектов карточек товара
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getProduct(productId: string): IProduct - возвращает карточку по ее id
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс UserData
Класс отвечает за хранение и логику работы с данными покупателя.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- payment: TPayMethod - метод оплаты, Онлайн или при получении
- address: string - адрес доставки
- email: string - данные электронной почты
- phone: string - данные телефонного номера
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getPayMethod(): TPayMethod - возвращает метод оплаты
- getUserInfo(): TUserData - возвращает данные адреса, электронной почты и телефона юзера
- setUserInfo(userData: IUser): void - сохраняет данные полученные от пользователя в классе
- SetPayMethod(payMethod: string): void - отвечает за выбор метода оплаты и сохраняет его в классе.
-  clearData(): void - очищает данные в классе.

#### Класс BasketData
Класс отвечает за хранение и логику работы с данными корзины с покупками.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- products: IProduct[] - массив объектов товара
- total: number - общая сумма покупок
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addProduct(product: IProduct): void; - добавляет один товар в начало массива и вызывает событие изменения массива
- deleteProduct(productId: string): void; - удаляет карточку из массива.
- checkProduct: (itemId: string) => boolean - проверяет наличие даннового товара в корзине по его id
- clearBasket: () => void - очищает корзину
- get total: () => number - возвращает общую сумму покупок
- get products: () => IProduct[] - возвращает массив товаров в корзине

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. Осуществляет блокировку прокрутки страницы при открытии модального окна. А так же рендеринг динамического содержимого в окно.

- constructor(container: HTMLElement, events: IEvents) Конструктор получает контейнер для модального окна и объект событий.

Поля класса
- closeButton: HTMLButtonElement — кнопка закрытия модального окна, инициализируется элементом с классом .modal__close.
- content: HTMLElement — элемент, который будет содержать динамически добавляемый контент, инициализируется элементом с классом .modal__content.
- container: HTMLElement — контейнер модального окна (передается в конструктор).
- events: IEvents — объект для обработки пользовательских событий, таких как открытие и закрытие модального окна.
- page: HTMLElement — элемент страницы с классом .page__wrapper, который будет блокироваться при открытии модального окна (чтобы предотвратить прокрутку страницы).

Методы:
- open(): void - Открывает модальное окно, добавляя класс modal_active к контейнеру, что обычно активирует его отображение. Также добавляет класс page__wrapper_locked к элементу страницы, что блокирует прокрутку.
- close(): void - Закрывает модальное окно, удаляя класс modal_active, что скрывает окно. Очищает содержимое модального окна. Убирает блокировку прокрутки страницы, удаляя класс page__wrapper_locked.
- render(data: HTMLElement): void - Очищает содержимое модального окна и добавляет в него переданный элемент data.
- handleEscUp(evt: KeyboardEvent): void - Обрабатывает событие нажатия клавиши Escape. Если пользователь нажал Escape, модальное окно закрывается с помощью метода close.

#### Класс Form
Родительский класс. Предназначен для управления формой, встроенной в модальное окно. Он включает логику обработки отправки формы, отображения ошибок ввода и рендеринга формы.

Поля класса:
- submitButton: HTMLButtonElement -  кнопка отправки формы.
- error: HTMLElement - элемент для отображения ошибок в форме.
- events: IEvents -  объект для работы с событиями

Конструктор:
- constructor(container: HTMLFormElement, events: IEvents) - Конструктор принимает два параметра: контейнер формы, и объект для работы с событиями.

Методы:
- showInputError(): void - ыводит сообщение об ошибке в элементе ошибок и отключает кнопку отправки.
- hideInputError(): void -Скрывает сообщение об ошибке и активирует кнопку отправки.
- render() - Возвращает контейнер формы, что позволяет использовать его для отображения формы

#### Класс ModalWithPayment
Наследуется от класса Form. Предназначен для реализации модального окна с формой содержащей кнопку выбора способа оплаты и поля ввода адреса.
Предоставляет методы для отображения ошибок и управления активностью кнопки продолжения оформления заказа.\
Поля класса:
- input: HTMLInputElement — элемент для ввода адреса.
- payment: TPayMethod — переменная, которая хранит выбранный метод оплаты.

Конструктор:
- constructor(container: HTMLFormElement, events: IEvents) - Конструктор принимает два параметра: контейнер формы, в котором содержатся поля для ввода и кнопки и объект для обработки событий.

Методы:
- getValid(isValid: boolean): void - изменяет активность кнопки продолжения оформления заказа
- getValues(): Record<string, string> - возвращает данные из полей ввода формы

#### Класс ModalWithForm
Наследуется от класса Form. Расширяет функциональность базового класса, добавляя работу с несколькими полями ввода, проверку их заполненности и сбор всех значений этих полей в объект для последующей обработки.
Поля класса:
- inputs: NodeListOf<HTMLInputElement>  - коллекция всех полей ввода

Конструктор:
- constructor(container: HTMLFormElement, events: IEvents) - Конструктор принимает два параметра: контейнер формы, в котором содержатся поля для ввода и кнопки и объект для обработки событий.
Вызывает конструктор родительского класса Form, который инициализирует базовые свойства.
С помощью метода querySelectorAll находит все поля ввода с классом .form__input и сохраняет их в коллекцию inputs.

Методы:
- getValid(isValid: boolean): void - изменяет активность кнопки продолжения оформления заказа
- getValues(): Record<string, string> - возвращает данные из полей ввода формы

#### Класс ModalWithSucces
 Предназначен для реализации модального окна с подтверждением оформления заказа.\
Поля класса:
- submitButton: HTMLButtonElement - Кнопка "за новыми покупками"
- description: HTMLElement — элемент с описанием результата офрмления заказа.
- events: IEvents — объект для работы с событиями.

Конструктор:
- constructor(content: HTMLElement, events: IEvents) - принимает два аргумента:
элемент, содержащий контент модального окна и объект для обработки событий.

Методы:
- render(total: number): HTMLElement - рендерит окно успешного заказа.

#### Класс Card
Класс служит для отображения карточки товара
Поля класса:
- cardId: string - id товара
- cardTitle: HTMLElement - элемент разметки отвечающий за отображение имени товара
- cardPrice: HTMLElement - элемент разметки отвечающий за отображение цены товара.
- cardImage: HTMLElement - элемент разметки отвечающий за отображение изображения товара
- cardCategory: HTMLElement - элемент разметки отвечающий за отображение категории товара.
- addBasketButton: HTMLButtonElement - кнопка добавления товара в корзину
- removeBasketButton: HTMLButtonElement - кнопка удаления товара из корзины
- index: HTMLElement - элемент разметки отвечающий за отображение порядкового номера карточки товара

Методы:
- геттер Id - получение id карточки товара
- setData(cardData: IProduct): void - устанавливает значения полей карточки товара
- checkInBasket(inBasket: boolean): void - устанавливает название кнопок добавления и удаления карточки в корзине в зависимости от его наличия в ней, а также устанавливает различные события при нажатии на кнопки
- setAndCheck(cardData: IProduct, inBasket: boolean): void - объединяет методы setData и checkInBasket
- render(): HTMLElement - возвращает разметку карточки

#### Класс CardsBasket
Предназначен  отображения элементов корзины и обновления информации о количестве товаров и общей стоимости. При открытии модального окна получает даные карточки товара из общего массива.\
Поля класса:
- element: корневой элемент корзины, полученный из шаблона.
- events: объект для работы с событиями (интерфейс IEvents).
- basketButton: кнопка для для офрмления покупки.
- content: элемент, содержащий список карточек товаров в корзине.
- basketPrice: элемент, отображающий общую стоимость товаров в корзине.

Метод:
render(data: HTMLElement[], total: number) -  метод отвечает за обновление отображаемого содержимого корзины.
- Очищает список товаров (content.innerHTML = '').
- Обновляет общую стоимость корзины, отображая переданную сумму (basketPrice. textContent = String(total) + ' синапсов').
- Если корзина пуста (нет данных), кнопка корзины отключается.
- Если данные присутствуют, кнопка активируется, и каждая карточка из списка данных добавляется в элемент content корзины.
- Каждой карточке присваивается порядковый номер, который отображается в элементе с классом .basket__item-index.

#### Класс CardsCatalog
Класс отвечает за отображение наполнения главной страницы.
Принимает в конструктор контейнер, в котором будет размещаться карточки товара.

Методы:
- render(cards: HTMLElement[]) - принимает массив элементов разметки с карточками и отображает их в каталоге.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

## Список событий
*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- products:changed - изменение массива данных продуктов
- basket:changed - изменение массива покупок в корзине при добавлнии/удалении товара

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- addres:submit - событие генерируемое при отправке формы адреса
- contact:submit - событие генерируемое при отправке формы контактов
- product:preview - событие генерируемое при открытии карточки
- product:delete - событие генерируемое при удалении карточки из корзины
- product:add - событие генерируемое при добавлении карточки в корзину
- basketButton:click - событие генерируемое при нажатии на кнопку корзины
- formOrder:submit - событие генерируемое при нажатии на кнопку оформления заказа
- modal:open - событие генерируемое при открытии модального окна
- modal:close - событие генерируемое при закрытии модального окна
- modalSuccess:close - событие генерируемое при закрытии окна "Заказ оформлен"
- basket:open - событие генерируемое при открытии корзины
- basket:render - событие генерируемое при отрисовке корзины
- preview:render - событие генерируемое при отрисовке карточки
- product:preview - событие генерируемое при открытии карточки
- dataOrder:post - событие генерируемое при отправке данных оформления заказа
