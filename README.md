# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src\scss\styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара

```
interface IProduct {
    _id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```

Данные покупателя

```
interface IUser {
    payMethod: string;
    address: string;
    email: string;
    phone: string;
}
```

Интерфейс для модели данных карточек товара

```
interface IProductsData {
    cards: IProduct[];
    preview: string | null;
}
```

Интерфейс для модели данных корзины

```
interface IBasket {
    products: IProduct[];
    product: string | null;
    addProduct(product: IProduct): void;
    deleteProduct(productId: string): void;
    priceCalc(productPrice: number): void;
}
```

Данные карточки, используемые для карточки на основной странице

```
type TProductMain = Pick<IProduct, 'image' | 'title' | 'category' | 'price'>;
```

Данные карточки, используемые в модальном окне карточки

```
type TProductModal = Pick<IProduct, 'description' | 'image' | 'title' | 'category' | 'price'>;
```

Данные карточки, используемые в корзине

```
type TBasket = Pick<IProduct, 'title' | 'price'>;
```

Данные метода оплаты

```
type TPayMethod = Pick<IUser, 'payMethod'>;
```

Данные покупателя, используемые в окне с вводом email и номера телефона

```
type TUserData = Pick<IUser, 'address' | 'email' | 'phone'>;
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными карточек товара.\
Конструктор класса принимает инстант брокера событий
В полях класса хранятся следующие данные:
- _products: IProduct[] - массив объектов карточек товара
- _preview: string | null - id карточки товара, выбранной для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getProduct(productId: string): IProduct - возвращает карточку по ее id
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс UserData
Класс отвечает за хранение и логику работы с данными покупателя.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _payMethod: string - метод оплаты, Онлайн или при получении
- _address: string - адрес доставки
- _email: string - данные электронной почты
- _phone: string - данные телефонного номера

- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getPayMethod(): TPayMethod - возвращает метод оплаты
- getUserInfo(): TUserData - возвращает данные адреса, электронной почты и телефона юзера
- setUserInfo(userData: IUser): void - сохраняет данные полученные от пользователя в классе
- SetPayMethod(payMethod: string): void - отвечает за выбор метода оплаты и сохраняет его в классе.
- checkValidation(data: Record<keyof TUserData, string>): boolean - проверяет объект с данными пользователя на валидность

#### Класс BasketData
Класс отвечает за хранение и логику работы с данными корзины с покупками.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- products: IProduct[] - массив объектов товара
- product: string | null- id товара, добавленного в корзину

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addProduct(product: IProduct): void; - добавляет один товар в начало массива и вызывает событие изменения массива
- deleteProduct(productId: string): void; - удаляет карточку из массива.

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

#### Класс ModalWithProduct
Расширяет класс Modal. Предназначен для реализации модального окна с карточкой товара. При открытии модального окна получает даные карточки товара из общего массива.\
Поля класса:
- imageElement: HTMLImageElement - элемент разметки с изображением
- categoryElement: HTMLElement - элемент разметки для вывода категории товара
- titleElement: HTMLElement - элемент разметки для вывода названия товара
- cardTextElement: HTMLElement - элемент разметки для вывода описания товара
- priceElement: HTMLElement - элемент разметки для вывода цены товара
- submitButton: HTMLButtonElement - кнопка добавления товара в корзину
- _id: string - id товара

Методы:
- open(data: {description: string, image: string, title: string, category: string, price: number }): void - расширение родительского метода, принимает данные товара, которые используются для заполнения атрибутов элементов модального окна.
- submitProduct(): IProduct - добавляет товар в корзину
- close(): void - расширяет родительский метод, выполняя дополнительно очистку атрибутов модального окна.

#### Класс ModalWithBasket
Расширяет класс Modal. Предназначен для реализации модального окна корзины с товарами. При открытии модального окна получает даные карточки товара из общего массива.\
Поля класса:
- submitButton: HTMLButtonElement - кнопка оформления заказа
- products: HTMLElement - элемент списка товаров в корзине
- totalPrice: HTMLElement- элемент разметки с суммой заказа

Методы:
- orderList(products: HTMLElement[]): void - отвечает за отображение списка товаров добавленных в корзину
- total(value: number) - отвечает за отображение полной стоимости заказа


#### Класс ModalWithPayment
Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей кнопку выбора способа оплаты и поля ввода адреса. 
Предоставляет методы для отображения ошибок и управления активностью кнопки продолжения оформления заказа.\
Поля класса:
- submitButton: HTMLButtonElement - кнопка "далее" для продолжения оформления заказа
- cardButton: HTMLButtonElement - кнопка для выбора оплаты "картой".
- receiptButton: HTMLButtonElement - кнопка для выбора оплаты "при получении".
- deliveryAddress: HTMLInputElement - элемент разметки с полем для ввода адреса доставки

Методы:
- getPayMethod(): TPayMethod - возвращает способ оплаты
- getAddress(): string - возвращает адрес доставки
- getValid(): boolean - метод возвращающий валидность формы
- close (): void - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- setValid(isValid: boolean): void - изменяет активность кнопки продолжения оформления заказа


#### Класс ModalWithForm
Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы.
Предоставляет методы для отображения ошибок и управления активностью кнопки продолжения оформления заказа.\
Поля класса:
- submitButton: HTMLButtonElement - Кнопка оплаты
- _email: HTMLInputElement - элемент разметки для ввода почты
- _phone: HTMLInputElement - элемент разметки для ввода номера телефона

Методы:
- getEmail(): string - возвращает данные из поля ввода почты
- getPhone(): string - возвращает данные из поля ыыода телефонного номера
- getValid(): boolean - метод возвращающий валидность формы
- setValid(isValid: boolean): void - изменяет активность кнопки оплаты заказа

#### Класс ModalWithSucces
асширяет класс Modal. Предназначен для реализации модального окна с подтверждением оформления заказа.\
Поля класса:
- submitButton: HTMLButtonElement - Кнопка "за новыми покупками"
- total: HTMLElement - элемент разметки отвечающий за отображение стоимости заказа

Методы:
- setTotal(total: string): void - устанавливает значение полной стоимости заказа в элемент разметки

#### Класс CardMainPage
Класс служит для отображения карточки на главной странице
Поля класса:
- _id: string - id товара
- _title: HTMLElement - элемент разметки отвечающий за отображение имени товара
- _price: HTMLElement - элемент разметки отвечающий за отображение цены товара.
- _image: HTMLElement - элемент разметки отвечающий за отображение изображения товара
- _category: HTMLElement - элемент разметки отвечающий за отображение категории товара.
- modalCardButton: HTMLButtonElement - обертка карточки товара на главной странице предтсавляющая из себя кнопку и служащая для открытия модального окна с карточкой товара

Методы:
- getId(): string - получение id карточки товара
- setTitle(value: string): void - устанавливает имя товара
- setPrice(value: string): void - устанавливает цену товара
- setImage(src: string): void - устанавливает ссылку картинки товара
- setCategory(value: string): void - устанавливает данные категории товара
- open(): void - открывет попап с карточкой товара

#### Класс CardBasket
Класс служит для отображения карточки товара в корзине.
Поля класса:
- _id: string - id товара
- _title: HTMLElement - элемент разметки отвечающий за отображение имени товара
- _price: HTMLElement - элемент разметки отвечающий за отображение цены товара.
- number: HTMLElement - элемент разметки отвечающий за порядковый номер товара в корзине.
- deleteButton: HTMLButtonElement - кнопка удаления товара из корзины.

Методы:
- setNumber(value: number) - устанавливает порядковый номер товара в корзине
- deleteProduct(): void - метод для удаления карточки товара из корзины

#### Класс MainPage
Класс отвечает за отображение наполнения главной страницы.
Поля класса:
- catalog: HTMLElement - элемент размети представляющий из себя контейнер для крточек товара
- basketButton: HTMLButtonElement - кнопка открытия корзины с товарами
- basketCounter: HTMLElement - элемент разметки отображающий количество товаров в корзине

Методы:
- setCatalog(cards: HTMLElement[]): void - отвечает за размещение карточек товара в соответствующем элементе разметки
- setBasketCounter(value: number) - отображает количество товаров в корзине
- open(): void - открывет попап с корзиной товаров


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

## Список событий
*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)* 
- products:changed - изменение массива данных продуктов
- basket:changed - изменение массива покупок в корзине при добавлнии/удалении товара

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- modal:open - событие генерируемое при открытии модального окна
- modal:close - событие генерируемое при закрытии модального окна
- basket:open - событие генерируемое при открытии корзины
- product:add - событие генерируемое при добавлении товара в корзину
- product:delete - событие генерируемое при удалении товара из корзины
- making-order:open - событие генерируемое при окрытии окна формления заказа
- pay:changed - событие генерируемое при изменении способа оплаты
- address:validation - событие сообщающее о необходимости валидации формы адресса
- addres:submit - событие гененрируемое при успешном прохождении формы выбора способа оплаты и ввода адреса
- contacts:validation - событие сообщающее о необходимости валидации формы почты и телефона
- contacts:submit - событие генерируемое при успешном прохождении формы контактных данных.
- succes:submit - событие генерируемое при успешном оформлении закза и закрытии соотвествующего попапа